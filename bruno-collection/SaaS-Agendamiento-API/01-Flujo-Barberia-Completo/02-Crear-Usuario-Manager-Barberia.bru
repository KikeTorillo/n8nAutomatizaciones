meta {
  name: 02 - Crear Usuario Manager Barbería
  type: http
  seq: 2
}

post {
  url: {{baseUrl}}/api/v1/auth/register
  body: json
  auth: bearer
}

auth:bearer {
  token: {{adminToken}}
}

headers {
  Content-Type: application/json
}

body:json {
  {
    "nombre": "Carlos",
    "apellidos": "Rodríguez García",
    "email": "manager@barbariaelclasico.com",
    "password": "manager123",
    "telefono": "+573009876543",
    "rol": "manager",
    "organizacion_id": "{{barbariaOrgId}}",
    "informacion_adicional": {
      "cargo": "Gerente General",
      "experiencia_anos": 8,
      "especialidades": ["gestión", "administración", "atención_cliente"],
      "fecha_ingreso": "2024-01-15"
    }
  }
}

tests {
  test("Status should be 201", function() {
    expect(res.getStatus()).to.equal(201);
  });

  test("Response should contain success true", function() {
    const body = res.getBody();
    expect(body).to.have.property('success', true);
  });

  test("Should create manager user", function() {
    const body = res.getBody();
    expect(body.data).to.have.property('rol', 'manager');
    expect(body.data).to.have.property('email', 'manager@barbariaelclasico.com');
  });

  test("Should belong to barbería organization", function() {
    const body = res.getBody();
    expect(body.data.organizacion_id).to.equal(bru.getVar("barbariaOrgId"));
  });

  test("Should set manager variables", function() {
    const body = res.getBody();
    if (body.success && body.data.id) {
      bru.setVar("managerBarberiaId", body.data.id);
      bru.setVar("managerBarberiaEmail", body.data.email);
    }
  });

  test("Manager ready for login", function() {
    const body = res.getBody();
    console.log("👨‍💼 Manager de Barbería creado exitosamente");
    console.log(`👤 Nombre: ${body.data.nombre} ${body.data.apellidos}`);
    console.log(`📧 Email: ${body.data.email}`);
    console.log(`🏢 Organización: ${bru.getVar("barbariaOrgId")}`);
    console.log(`🔑 Rol: ${body.data.rol}`);
    console.log("📝 Credenciales: manager@barbariaelclasico.com / manager123");
  });
}