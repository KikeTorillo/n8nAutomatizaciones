meta {
  name: 06 - Crear Cliente Regular BarberÃ­a
  type: http
  seq: 6
}

post {
  url: {{baseUrl}}/api/v1/clientes
  body: json
  auth: bearer
}

auth:bearer {
  token: {{managerBarberiaToken}}
}

headers {
  Content-Type: application/json
}

body:json {
  {
    "nombre": "AndrÃ©s",
    "apellidos": "GÃ³mez MartÃ­nez",
    "email": "andres.gomez@email.com",
    "telefono": "+573501234567",
    "fecha_nacimiento": "1985-03-15",
    "preferencias": {
      "profesional_preferido": "{{barberoId}}",
      "servicios_frecuentes": ["corte_clasico", "barba"],
      "horario_preferido": "tarde",
      "frecuencia_visitas": "quincenal",
      "notas_especiales": "Prefiere corte conservador para trabajo en oficina"
    },
    "informacion_adicional": {
      "ocupacion": "Contador",
      "como_conocio": "recomendacion_amigo",
      "fecha_primer_visita": "2023-05-10",
      "cliente_desde": "2023-05-10"
    }
  }
}

tests {
  test("Status should be 201", function() {
    expect(res.getStatus()).to.equal(201);
  });

  test("Response should contain success true", function() {
    const body = res.getBody();
    expect(body).to.have.property('success', true);
  });

  test("Should create cliente", function() {
    const body = res.getBody();
    expect(body.data).to.have.property('nombre', 'AndrÃ©s');
    expect(body.data).to.have.property('apellidos', 'GÃ³mez MartÃ­nez');
  });

  test("Should belong to barberÃ­a organization", function() {
    const body = res.getBody();
    expect(body.data.organizacion_id).to.equal(bru.getVar("barbariaOrgId"));
  });

  test("Should have barbero as preferred professional", function() {
    const body = res.getBody();
    expect(body.data.preferencias.profesional_preferido).to.equal(bru.getVar("barberoId"));
  });

  test("Should set cliente variables", function() {
    const body = res.getBody();
    if (body.success && body.data.id) {
      bru.setVar("clienteBarberiaId", body.data.id);
      bru.setVar("clienteBarberiaEmail", body.data.email);
    }
  });

  test("Cliente barberÃ­a ready", function() {
    const body = res.getBody();
    console.log("ğŸ‘¨â€ğŸ’¼ Cliente de BarberÃ­a creado exitosamente");
    console.log(`ğŸ‘¤ Nombre: ${body.data.nombre} ${body.data.apellidos}`);
    console.log(`ğŸ“§ Email: ${body.data.email}`);
    console.log(`ğŸ“± TelÃ©fono: ${body.data.telefono}`);
    console.log(`â­ Profesional preferido: ${body.data.preferencias.profesional_preferido}`);
    console.log(`ğŸ’‡â€â™‚ï¸ Servicios frecuentes: ${body.data.preferencias.servicios_frecuentes.join(', ')}`);
    console.log(`â° Horario preferido: ${body.data.preferencias.horario_preferido}`);
    console.log(`ğŸ“… Cliente desde: ${body.data.informacion_adicional.cliente_desde}`);
    console.log(`ğŸ†” ID Cliente: ${body.data.id}`);
  });
}