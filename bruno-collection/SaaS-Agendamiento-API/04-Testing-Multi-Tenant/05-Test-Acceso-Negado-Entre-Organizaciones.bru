meta {
  name: 05 - Test Acceso Negado Entre Organizaciones
  type: http
  seq: 5
}

get {
  url: {{baseUrl}}/api/v1/profesionales/{{barberoId}}
  body: none
  auth: bearer
}

auth:bearer {
  token: {{managerBarberiaToken}}
}

headers {
  Content-Type: application/json
}

tests {
  test("Status should be 200 for own professional", function() {
    expect(res.getStatus()).to.equal(200);
  });

  test("Manager barbería PUEDE ver su propio barbero", function() {
    const body = res.getBody();
    expect(body).to.have.property('success', true);
    expect(body.data).to.have.property('id', bru.getVar("barberoId"));
    expect(body.data.organizacion_id).to.equal(bru.getVar("barbariaOrgId"));
  });

  test("Verificar acceso PERMITIDO a recursos propios", function() {
    const body = res.getBody();
    console.log("✅ ACCESO PERMITIDO A RECURSOS PROPIOS:");
    console.log(`  • Manager barbería accede a su barbero: ${body.data.nombre} ${body.data.apellidos}`);
    console.log(`  • Organización: ${body.data.organizacion_id}`);
    console.log(`  • ID Profesional: ${body.data.id}`);
    console.log("  • ✅ RLS permite acceso a recursos de la misma organización");
  });
}