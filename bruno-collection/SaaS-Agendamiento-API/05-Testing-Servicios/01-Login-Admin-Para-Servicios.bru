meta {
  name: 01-Login-Admin-Para-Servicios
  type: http
  seq: 1
}

post {
  url: {{baseUrl}}/api/{{apiVersion}}/auth/login
  body: json
  auth: none
}

body:json {
  {
    "email": "{{adminEmail}}",
    "password": "{{adminPassword}}"
  }
}

assert {
  res.status: eq 200
  res.body.success: eq true
  res.body.data.usuario.email: eq {{adminEmail}}
  res.body.data.accessToken: isDefined
}

script:post-response {
  if (res.body.success) {
    bru.setEnvVar("accessToken", res.body.data.accessToken);
    bru.setEnvVar("refreshToken", res.body.data.refreshToken);
    bru.setEnvVar("userId", res.body.data.usuario.id);
    bru.setEnvVar("organizacionId", res.body.data.usuario.organizacion_id);
    
    console.log("✅ Login exitoso para testing de servicios");
    console.log("Token:", res.body.data.accessToken.substring(0, 20) + "...");
    console.log("Organización ID:", res.body.data.usuario.organizacion_id);
  }
}